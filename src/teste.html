<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
</head>

<body>
    <input type="text" id="emailLog" placeholder="Email">
    <input type="password" id="passwordLog" placeholder="Password">
    <button id="loginButton">Login</button>

    <script>
        class Connection {
            constructor() {
                this.firebaseConfig = {
                    apiKey: "AIzaSyAtsOLZep8R3GIw-Zmjyur0iowdrGqEQ4Q",

                    authDomain: "teste-fb1cb.firebaseapp.com",

                    projectId: "teste-fb1cb",

                    storageBucket: "teste-fb1cb.appspot.com",

                    messagingSenderId: "731842263197",

                    appId: "1:731842263197:web:7d351cd55d26ff40d73c74",

                    measurementId: "G-L12HRYDS7T"
                };

                if (!firebase.apps.length) {
                    firebase.initializeApp(this.firebaseConfig);
                }

                this.auth = firebase.auth();
                this.database = firebase.database();
                this.mensagem = '';
                this.confirmErro = false;
            }

            login(email, password) {
                return this.auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        const user = userCredential.user;
                        return this.database.ref('Users/' + user.uid).update({ last_login: new Date().toString() })
                            .then(() => {
                                this.mensagem = 'UsuÃ¡rio logado!';
                                this.confirmErro = false;
                                return 1;
                            });
                    })
                    .catch((error) => {
                        this.mensagem = error.message;
                        this.confirmErro = true;
                        return 0;
                    });
            }
        }

        document.getElementById('loginButton').addEventListener('click', function () {
            const email = document.getElementById('emailLog').value;
            const password = document.getElementById('passwordLog').value;
            const connection = new Connection();

            connection.login(email, password).then((loginResult) => {
                console.log(loginResult);

                if (loginResult === 1) {
                    window.location.href = "views/html/index.html";
                } else {
                    console.error("Login failed:", connection.mensagem);
                }
            });
        });
    </script>
</body>

</html>